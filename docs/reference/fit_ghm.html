<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>EM estimation for Gaussian Hidden Markov field — fit_ghm • mrf2d</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="EM estimation for Gaussian Hidden Markov field — fit_ghm" />
<meta property="og:description" content="fit_ghm fits a Gaussian Mixture model with hidden components
driven by a Markov random field with known parameters. The inclusion of a
linear combination of basis functions as a fixed effect is also possible.
The algorithm is an implementation of
(Zhang et al. 2001)
." />
<meta property="og:image" content="https://freguglia.github.io/mrf2d/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mrf2d</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/mrf2d.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Freguglia/mrf2d">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>EM estimation for Gaussian Hidden Markov field</h1>
    <small class="dont-index">Source: <a href='https://github.com/Freguglia/mrf2d/blob/master/R/fit_ghm.R'><code>R/fit_ghm.R</code></a></small>
    <div class="hidden name"><code>fit_ghm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>fit_ghm</code> fits a Gaussian Mixture model with hidden components
driven by a Markov random field with known parameters. The inclusion of a
linear combination of basis functions as a fixed effect is also possible.</p>
<p>The algorithm is an implementation of
(Zhang et al. 2001)
.</p>
    </div>

    <pre class="usage"><span class='fu'>fit_ghm</span>(<span class='no'>Y</span>, <span class='no'>mrfi</span>, <span class='no'>theta</span>, <span class='kw'>fixed_fn</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(), <span class='kw'>equal_vars</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>init_mus</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>init_sigmas</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>maxiter</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>max_dist</span> <span class='kw'>=</span> <span class='fl'>10</span>^-<span class='fl'>3</span>, <span class='kw'>icm_cycles</span> <span class='kw'>=</span> <span class='fl'>6</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>qr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>A matrix of observed (continuous) pixel values.</p></td>
    </tr>
    <tr>
      <th>mrfi</th>
      <td><p>A <code><a href='mrfi-class.html'>mrfi</a></code> object representing the
interaction structure.</p></td>
    </tr>
    <tr>
      <th>theta</th>
      <td><p>A 3-dimensional array describing potentials. Slices represent
interacting positions, rows represent pixel values and columns represent
neighbor values. As an example: <code>theta[1,3,2]</code> has the potential pairs of
values 0,2 in the second relative position of <code>mrfi</code>.</p></td>
    </tr>
    <tr>
      <th>fixed_fn</th>
      <td><p>A list of functions <code>fn(x,y)</code> to be considered as a fixed
effect. See <code><a href='basis_functions.html'>basis_functions</a></code>.</p></td>
    </tr>
    <tr>
      <th>equal_vars</th>
      <td><p><code>logical</code> indicating if the mixture model has the same
variances in all mixture components.</p></td>
    </tr>
    <tr>
      <th>init_mus</th>
      <td><p>Optional. A <code>numeric</code> with length (C+1) with the initial mean
estimate for each component.</p></td>
    </tr>
    <tr>
      <th>init_sigmas</th>
      <td><p>Otional. A <code>numeric</code> with length (C+1) with initial sample
deviation estimate for each component.</p></td>
    </tr>
    <tr>
      <th>maxiter</th>
      <td><p>The maximum number of iterations allowed. Defaults to 100.</p></td>
    </tr>
    <tr>
      <th>max_dist</th>
      <td><p>Defines a stopping condition. The algorithm stops if the
maximum absolute difference between parameters of two consecutive iterations
is less than <code>max_dist</code>.</p></td>
    </tr>
    <tr>
      <th>icm_cycles</th>
      <td><p>Number of steps used in the Iterated Conditional Modes
algorithm executed in each interaction. Defaults to 6.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p><code>logical</code> indicating wheter to print the progress or not.</p></td>
    </tr>
    <tr>
      <th>qr</th>
      <td><p>The QR decomposition of the design matrix. Used internally.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>list</code> containing:</p><ul>
<li><p><code>par</code>: A <code>data.frame</code> with \(\mu\) and \(\sigma\) estimates for each
component.</p></li>
<li><p><code>fixed</code>: A <code>matrix</code> with the estimated fixed effect in each pixel.</p></li>
<li><p><code>Z_pred</code>: A <code>matrix</code> with the predicted component (highest probability) in
each pixel.</p></li>
<li><p><code>predicted</code>: A <code>matrix</code> with the fixed effect + the \(\mu\) value for
the predicted component in each pixel.</p></li>
<li><p><code>iterations</code>: Number of EM iterations done.</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If either <code>init_mus</code> or <code>init_sigmas</code> is <code>NULL</code> an EM algorithm
considering an independent uniform distriburion for the hidden component is
fitted first and its estimated means and sample deviations are used as
initial values. This is necessary because the algorithm may not converge if
the initial parameter configuration is too far from the maximum likelihood
estimators.</p>
<p><code>max_dist</code> defines a stopping condition. The algorithm will stop if the
maximum absolute difference between (\(\mu\) and \(\sigma\)) parameters
in consecutive iterations is less than <code>max_dist</code>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Zhang Y, Brady M, Smith S (2001).
&#8220;Segmentation of brain MR images through a hidden Markov random field model and the expectation-maximization algorithm.&#8221;
<em>IEEE transactions on medical imaging</em>, <b>20</b>(1), 45--57.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Sample a Gaussian mixture with components given by Z_potts</span>
<span class='co'># mean values are 0, 1 and 2 and a linear effect on the x-axis.</span>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>2</span>)
<span class='no'>Y</span> <span class='kw'>&lt;-</span> <span class='no'>Z_potts</span> + <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>Z_potts</span>), <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fl'>0.4</span>) +
      (<span class='fu'><a href='https://rdrr.io/r/base/row.html'>row</a></span>(<span class='no'>Z_potts</span>) - <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/row.html'>row</a></span>(<span class='no'>Z_potts</span>)))*<span class='fl'>0.01</span>
<span class='co'># Check what the data looks like</span>
<span class='fu'><a href='dplot.html'>cplot</a></span>(<span class='no'>Y</span>)

<span class='no'>fixed</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='basis_functions.html'>polynomial_2d</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>0</span>), <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span>(<span class='no'>Y</span>))
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_ghm</span>(<span class='no'>Y</span>, <span class='kw'>mrfi</span> <span class='kw'>=</span> <span class='fu'><a href='mrfi.html'>mrfi</a></span>(<span class='fl'>1</span>), <span class='kw'>theta</span> <span class='kw'>=</span> <span class='no'>theta_potts</span>, <span class='kw'>fixed_fn</span> <span class='kw'>=</span> <span class='no'>fixed</span>)
<span class='no'>fit</span>$<span class='no'>par</span>
<span class='fu'><a href='dplot.html'>cplot</a></span>(<span class='no'>fit</span>$<span class='no'>fixed</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Victor Freguglia</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Victor Freguglia.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


