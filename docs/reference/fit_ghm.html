<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>EM estimation for Gaussian Hidden Markov field — fit_ghm • mrf2d</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="EM estimation for Gaussian Hidden Markov field — fit_ghm"><meta property="og:description" content="fit_ghm fits a Gaussian Mixture model with hidden components
driven by a Markov random field with known parameters. The inclusion of a
linear combination of basis functions as a fixed effect is also possible.
The algorithm is a modification of of
(Zhang et al. 2001)
, which is
described in (Freguglia et al. 2020)
."><meta property="og:image" content="https://freguglia.github.io/mrf2d/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mrf2d</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/mrf2d-family.html">Parameter restriction families in mrf2d</a>
    </li>
    <li>
      <a href="../articles/three-dimensions-on-mrf2d.html">Working with 3d lattices in mrf2d</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/Freguglia/mrf2d/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>EM estimation for Gaussian Hidden Markov field</h1>
    <small class="dont-index">Source: <a href="https://github.com/Freguglia/mrf2d/blob/HEAD/R/fit_ghm.R" class="external-link"><code>R/fit_ghm.R</code></a></small>
    <div class="hidden name"><code>fit_ghm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>fit_ghm</code> fits a Gaussian Mixture model with hidden components
driven by a Markov random field with known parameters. The inclusion of a
linear combination of basis functions as a fixed effect is also possible.</p>
<p>The algorithm is a modification of of
(Zhang et al. 2001)
, which is
described in (Freguglia et al. 2020)
.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">fit_ghm</span><span class="op">(</span>
  <span class="va">Y</span>,
  <span class="va">mrfi</span>,
  <span class="va">theta</span>,
  fixed_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,
  equal_vars <span class="op">=</span> <span class="cn">FALSE</span>,
  init_mus <span class="op">=</span> <span class="cn">NULL</span>,
  init_sigmas <span class="op">=</span> <span class="cn">NULL</span>,
  maxiter <span class="op">=</span> <span class="fl">100</span>,
  max_dist <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">3</span>,
  icm_cycles <span class="op">=</span> <span class="fl">6</span>,
  verbose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span>,
  qr <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>Y</dt>
<dd><p>A matrix of observed (continuous) pixel values.</p></dd>
<dt>mrfi</dt>
<dd><p>A <code><a href="mrfi-class.html">mrfi</a></code> object representing the
interaction structure.</p></dd>
<dt>theta</dt>
<dd><p>A 3-dimensional array describing potentials. Slices represent
interacting positions, rows represent pixel values and columns represent
neighbor values. As an example: <code>theta[1,3,2]</code> has the potential for the
pair of values 0,2 observed in the second relative position of <code>mrfi</code>.</p></dd>
<dt>fixed_fn</dt>
<dd><p>A list of functions <code>fn(x,y)</code> to be considered as a fixed
effect. See <code><a href="basis_functions.html">basis_functions</a></code>.</p></dd>
<dt>equal_vars</dt>
<dd><p><code>logical</code> indicating if the mixture model has the same
variances in all mixture components.</p></dd>
<dt>init_mus</dt>
<dd><p>Optional. A <code>numeric</code> with length (C+1) with the initial mean
estimate for each component.</p></dd>
<dt>init_sigmas</dt>
<dd><p>Otional. A <code>numeric</code> with length (C+1) with initial sample
deviation estimate for each component.</p></dd>
<dt>maxiter</dt>
<dd><p>The maximum number of iterations allowed. Defaults to 100.</p></dd>
<dt>max_dist</dt>
<dd><p>Defines a stopping condition. The algorithm stops if the
maximum absolute difference between parameters of two consecutive iterations
is less than <code>max_dist</code>.</p></dd>
<dt>icm_cycles</dt>
<dd><p>Number of steps used in the Iterated Conditional Modes
algorithm executed in each interaction. Defaults to 6.</p></dd>
<dt>verbose</dt>
<dd><p><code>logical</code> indicating wheter to print the progress or not.</p></dd>
<dt>qr</dt>
<dd><p>The QR decomposition of the design matrix. Used internally.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>hmrfout</code> containing:</p><ul><li><p><code>par</code>: A <code>data.frame</code> with \(\mu\) and \(\sigma\) estimates for each
component.</p></li>
<li><p><code>fixed</code>: A <code>matrix</code> with the estimated fixed effect in each pixel.</p></li>
<li><p><code>Z_pred</code>: A <code>matrix</code> with the predicted component (highest probability) in
each pixel.</p></li>
<li><p><code>predicted</code>: A <code>matrix</code> with the fixed effect + the \(\mu\) value for
the predicted component in each pixel.</p></li>
<li><p><code>iterations</code>: Number of EM iterations done.</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>If either <code>init_mus</code> or <code>init_sigmas</code> is <code>NULL</code> an EM algorithm
considering an independent uniform distriburion for the hidden component is
fitted first and its estimated means and sample deviations are used as
initial values. This is necessary because the algorithm may not converge if
the initial parameter configuration is too far from the maximum likelihood
estimators.</p>
<p><code>max_dist</code> defines a stopping condition. The algorithm will stop if the
maximum absolute difference between (\(\mu\) and \(\sigma\)) parameters
in consecutive iterations is less than <code>max_dist</code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Freguglia V, Garcia NL, Bicas JL (2020).
“Hidden Markov random field models applied to color homogeneity evaluation in dyed textile images.”
<em>Environmetrics</em>, <b>31</b>(4), e2613.<br><br> Zhang Y, Brady M, Smith S (2001).
“Segmentation of brain MR images through a hidden Markov random field model and the expectation-maximization algorithm.”
<em>IEEE transactions on medical imaging</em>, <b>20</b>(1), 45--57.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>A paper with detailed description of the package can be found at
doi: <a href="https://doi.org/10.18637/jss.v101.i08" class="external-link">10.18637/jss.v101.i08</a>
.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Victor Freguglia</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Sample a Gaussian mixture with components given by Z_potts</span></span>
<span class="r-in"><span class="co"># mean values are 0, 1 and 2 and a linear effect on the x-axis.</span></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span class="r-in"><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">Z_potts</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Z_potts</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span class="r-in">      <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.html" class="external-link">row</a></span><span class="op">(</span><span class="va">Z_potts</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.html" class="external-link">row</a></span><span class="op">(</span><span class="va">Z_potts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">0.01</span></span>
<span class="r-in"><span class="co"># Check what the data looks like</span></span>
<span class="r-in"><span class="fu"><a href="dplot.html">cplot</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span></span>
<span class="r-plt img"><img src="fit_ghm-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="basis_functions.html">polynomial_2d</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">fit_ghm</span><span class="op">(</span><span class="va">Y</span>, mrfi <span class="op">=</span> <span class="fu"><a href="mrfi-class.html">mrfi</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, theta <span class="op">=</span> <span class="va">theta_potts</span>, fixed_fn <span class="op">=</span> <span class="va">fixed</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Fitting independent mixture to obtain initial parameters. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  EM iteration: 1 EM iteration: 2 EM iteration: 3 EM iteration: 4 EM iteration: 5 EM iteration: 6 Finished with 6 iterations. </span>
<span class="r-in"><span class="va">fit</span><span class="op">$</span><span class="va">par</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             mu     sigma</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0 -0.001568028 0.4012135</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  0.999990536 0.3966913</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2.002972466 0.4026593</span>
<span class="r-in"><span class="fu"><a href="dplot.html">cplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">fixed</span><span class="op">)</span></span>
<span class="r-plt img"><img src="fit_ghm-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># }</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Victor Freguglia.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

